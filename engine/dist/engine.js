(()=>{"use strict";const t=function(){function t(){}return t.calculateDeltaTime=function(n){if(!t.lastTimestamp)return t.lastTimestamp=n,void(t.fps=0);t.deltaTime=(n-t.lastTimestamp)/1e3,t.lastTimestamp=n,t.fps=1/t.deltaTime},t.lastTimestamp=performance.now(),t}(),n=function(t,n){this.x=t,this.y=n},e=function(){};var o,r=(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)});const i=function(t){function e(e,o){var r=t.call(this)||this;return r.transform=e,r.isTrigger=o,r.points=new Array,r.transform=e,r.isTrigger=o,r.points.push(new n(e.x,e.y)),r.points.push(new n(e.x+e.width,e.y)),r.points.push(new n(e.x,e.y+e.height)),r.points.push(new n(e.x+e.width,e.y+e.height)),r}return r(e,t),e}(e),s=function(){function t(){}return t.register=function(n,e){if(!t.managers.has(n.name)){var o=new e;t.managers.set(n.name,o)}},t.get=function(n){if(t.managers.has(n))return t.managers.get(n);throw"Manager has not been registered: "+n},t.log=function(){t.managers.forEach((function(t){return console.log(t)}))},t.managers=new Map,t}();var c=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const a=function(t){function n(n){var e=t.call(this)||this;return e.scritableEntity=n,e}return c(n,t),n}(e);var u=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const p=function(t){function n(n){var e=t.call(this)||this;return e.transform=n,e}return u(n,t),n}(e),f=function(){};var l;!function(t){t[t.NONE=0]="NONE",t[t.TOP=1]="TOP",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM=3]="BOTTOM",t[t.LEFT=4]="LEFT"}(l||(l={}));var h=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const y=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="collision",n.currentEntityCollisions=new Map,n}return h(n,t),n.prototype.dispose=function(t){this.currentEntityCollisions.has(t.id)&&this.currentEntityCollisions.delete(t.id),this.currentEntityCollisions.forEach((function(n,e){var o=n.indexOf(t.id);-1!==o&&n.splice(o,1)}))},n.prototype.update=function(){for(var t=s.get(i.name),n=0;n<t.entities.length;n++)for(var e=n+1;e<t.entities.length;e++)this.resolveCollision(t.entities[n],t.entities[e])},n.prototype.resolveCollision=function(t,n){if(t&&n){var e=t.getComponent(i),o=n.getComponent(i),r=t.getComponent(p),c=n.getComponent(p);if(r&&c){var u=r.transform,f=c.transform,h=u.x+u.width/2-(f.x+f.width/2),y=u.y+u.height/2-(f.y+f.height/2),g=u.width/2+f.width/2,d=u.height/2+f.height/2,v=l.NONE;if(Math.abs(h)<g&&Math.abs(y)<d)if(this.currentEntityCollisions.has(t.id)&&-1!==this.currentEntityCollisions.get(t.id).indexOf(n.id))console.log("TRIGGER STAY"),t.getScriptInstances().forEach((function(t){t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerStay(n)})),n.getScriptInstances().forEach((function(n){n.instance&&n.instance.onTriggerEnter&&n.instance.onTriggerStay(t)}));else if(this.currentEntityCollisions.has(t.id)?this.currentEntityCollisions.get(t.id).push(n.id):this.currentEntityCollisions.set(t.id,[n.id]),e.isTrigger||o.isTrigger)console.log("TRIGGER ENTER"),console.log(t),console.log(n),t.getScriptInstances().forEach((function(t){t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerEnter(n)})),n.getScriptInstances().forEach((function(n){n.instance&&n.instance.onTriggerEnter&&n.instance.onTriggerEnter(t)}));else{var _=g-Math.abs(h),m=d-Math.abs(y);_>=m?y>0?(v=l.TOP,u.y+=m):(v=l.BOTTOM,u.y-=m):h>0?(v=l.LEFT,u.x+=_):(v=l.RIGHT,u.x-=_)}else this.currentEntityCollisions.has(t.id)&&-1!==this.currentEntityCollisions.get(t.id).indexOf(n.id)&&(this.currentEntityCollisions.delete(t.id),s.get(a.name).instances,t.getScriptInstances().forEach((function(t){t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerLeave(n)})),n.getScriptInstances().forEach((function(n){n.instance&&n.instance.onTriggerEnter&&n.instance.onTriggerLeave(t)})));return v}console.log("[ENTITY NO LONGER EXISTS ABORTING COLLISION CHECK]")}},n}(f);var g=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const d=function(t){function n(n){var e=t.call(this)||this;return e.camera=n,e}return g(n,t),n}(e);var v=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const _=function(t){function n(n,e,o,r){var i=t.call(this)||this;return i.layer=n,i.tilesetIndex=e,i.row=o,i.column=r,i}return v(n,t),n}(e);var m=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const w=function(t){function n(n){var e=t.call(this)||this;return e.name=n,e}return m(n,t),n}(e);var b=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const x=function(t){function n(n){var e=t.call(this)||this;return e.source=n,e}return b(n,t),n}(e);var O=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const C=function(t){function n(n,e){var o=t.call(this)||this;return o.alpha=1,o.fillStyle=n,o.alpha=e,o}return O(n,t),n}(e),E=function(){function t(){}return t.componentTypes=[w,p,_,C,i,d,x,a],t.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t}(),A=function(){function t(){this.orthographicSize=5}return t.prototype.isClampedX=function(){return this.viewport.x>=this.max.x/2||0===this.viewport.x},t.prototype.isClampedY=function(){return this.viewport.y>=this.max.y/2||0===this.viewport.y},t.prototype.update=function(){},t}(),S=function(){function t(){this.id="",this.enabled=!0}return t.prototype.addComponent=function(t){s.get(t.constructor.name).addComponentInstance(this,t)},t.prototype.getComponent=function(t){if(t.name===a.name)throw"Getting script components is not currently supported.";var n=s.get(t.name);return n.instances[n.map[this.id]]},t.prototype.getScriptInstances=function(){return[]},t}(),T=function(){function t(t,n,e,o){this.x=t,this.y=n,this.width=e,this.height=o}return t.prototype.getScreenX=function(t){return this.x-t.viewport.x},t.prototype.clampX=function(t,n){return this.x<t?(this.x=t,!0):this.x>n?(this.x=n,!0):void 0},t.prototype.clampY=function(t,n){return this.y<=t?(this.y=t,!0):this.y>=n?(this.y=n,!0):void 0},t.prototype.offsetX=function(){return this.x+this.width},t.prototype.offsetY=function(){return this.y+this.height},t.prototype.lerp=function(t,n,e){return t+(n-t)*((e=e<0?0:e)>1?1:e)},Object.defineProperty(t,"empty",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t}(),j=function(){function t(){}return t.register=function(n){-1===t.systems.findIndex((function(t){return t.name===n.name}))&&t.systems.push(n)},t.get=function(n){return t.systems.find((function(t){return t.name===n}))},t.systems=[],t}(),P=function(){function t(){this.entities=[]}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.create=function(){var t=new S;this.entities.push(t);for(var n="",e=0;e<8;e++){var o=Math.floor(Math.random()*E.characters.length);n+=E.characters.substring(o,o+1)}return t.id="entity-"+n,t.addComponent(new w("entity"+t.id)),t.addComponent(new p(T.empty)),t},t.prototype.dispose=function(t){var n=this.entities.findIndex((function(n){return n.id===t.id}));-1!==n&&(s.managers.forEach((function(n){return n.dispose(t)})),j.systems.forEach((function(n){return n.dispose(t)})),this.entities.splice(n,1))},t.prototype.parseEntities=function(e){var o=[];e.entities.forEach((function(t){var e=new S;for(var r in e.id=t.id,e.enabled=t.enabled,t){var s=t[r];if(s)if("spriteRendererComponent"===r)e.addComponent(new _(s.layer,s.tileset,s.row,s.column));else if("transformComponent"===r)e.addComponent(new p(new T(s.x,s.y,s.width,s.height)));else if("cameraComponent"===r){var c=new A;c.viewport=new T(s.camera.viewport.x,s.camera.viewport.y,s.camera.viewport.width,s.camera.viewport.height),c.max=new n(s.camera.max.x,s.camera.max.y),e.addComponent(new d(c))}else"tagComponent"===r?e.addComponent(new w(s.name)):"colliderComponent"===r&&e.addComponent(new i(s.transform,s.isTrigger))}o.push(e)})),t.getInstance().entities=o},t.prototype.packEntities=function(){var n=[];return t.getInstance().entities.forEach((function(t){var e={};E.componentTypes.forEach((function(n){var o=t.getComponent(n);o&&(e[n.name.charAt(0).toLowerCase()+n.name.slice(1)]=o)})),0!==Object.keys(e).length&&e.constructor===Object&&n.push(e)})),n},t.prototype.getComponents=function(t){var n=[];return s.managers.forEach((function(e){e.map[t.id]&&n.push(e.instances[e.map[t.id]])})),n},t}(),R=function(){function t(){}return t.engineConfig=null,t.gridSquareSize=32,t.canvasFill="#181818",t.selectionTransformFill="rgba(252,248,227, 0.7)",t}(),I=function(t){this.image=t},L=function(t,n){this.tilesets=[],this.scene=t,this.tilesets=n};var M=function(t,n,e,o){return new(e||(e=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function c(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}a((o=o.apply(t,n||[])).next())}))},U=function(t,n){var e,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(t,s)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};const N=function(){function t(){}return t.load=function(t,n){return void 0===n&&(n=null),M(this,void 0,void 0,(function(){var e,o,r,i,s=this;return U(this,(function(c){switch(c.label){case 0:return console.log("[ENGINE]: Started loading scene."),e="scenes\\"+t+".json",n&&(e=n+"\\"+e),console.log(e),[4,fetch(e)];case 1:return o=c.sent(),console.log("[ENGINE]: Scene feteched successfully;"),[4,o.json()];case 2:return r=c.sent(),console.log("[ENGINE]: Scene parsed successfully;"),P.getInstance().parseEntities(r),console.log("[ENGINE]: Scene entities parsed successfully."),i=[],r.tilesets.forEach((function(t,n){return M(s,void 0,void 0,(function(){var n,e;return U(this,(function(o){switch(o.label){case 0:return console.log(t),n=new Image,e="tilesets/"+t,R.baseUrl&&(e="file://"+R.baseUrl.replace(/\\/g,"/")+"/"+e),n.src=e,[4,n.decode()];case 1:return o.sent(),i.push(new I(n)),[2]}}))}))})),[2,new L(r,i)]}}))}))},t}(),F=function(){function t(){this.instances=[],this.entities=[],this.map={}}return t.prototype.addComponentInstance=function(t,n){if(this.map[t.id]){if(typeof n!=typeof a)throw"["+n.constructor.name+"]: You can't not have multiple component of the same type on entity unless that component is a script."}else this.entities.push(t);this.instances.push(n),this.map[t.id]=this.instances.length-1},t.prototype.getInstance=function(t){var n=this.map[t.id];return n||0===n?this.instances[n]:null},t.prototype.dispose=function(t){if("ScriptComponentManager"===this.constructor.name&&console.log(this),this.map[t.id]){this.instances.splice(this.map[t.id]),delete this.map[t.id];var n=this.entities.findIndex((function(n){return n.id===t.id}));-1!==n&&this.entities.splice(n,1),console.log(this)}},t}();var B=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const D=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return B(n,t),n}(F);var G=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const z=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return G(n,t),n}(F);var H=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const k=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return H(n,t),n}(F);var Y=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const W=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Y(n,t),n}(F);var X=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return X(n,t),n}(F);var V=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const K=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return V(n,t),n}(F);var J=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const Q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return J(n,t),n}(F);var Z=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const $=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="script",n}return Z(n,t),n.prototype.update=function(){var t=s.get(a.name);t.entities.forEach((function(n){var e=t.getInstance(n);e.instance||(e.instance=new e.scritableEntity,e.instance.onCreate()),e.instance.update()}))},n.prototype.dispose=function(t){},n}(f);var tt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const nt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return tt(n,t),n}(F),et=function(t,n){if(this.tilesets=[],this.scene=t,this.tilesets=n,!this.scene)throw"You cannot initialize the renderer without a scene.";if(!this.tilesets||0===this.tilesets.length)throw"You cannot initialize the renderer without any tilesets."},ot=function(){function t(){}return t.identity=function(){return[1,0,0,0,1,0,0,0,1]},t.translation=function(t,n,e){return[1,0,0,0,0,1,0,0,0,0,1,0,t,n,e,1]},t.xRotation=function(t){var n=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,n,e,0,0,-e,n,0,0,0,0,1]},t.yRotation=function(t){var n=Math.cos(t),e=Math.sin(t);return[n,0,-e,0,0,1,0,0,e,0,n,0,0,0,0,1]},t.zRotation=function(t){var n=Math.cos(t),e=Math.sin(t);return[n,e,0,0,-e,n,0,0,0,0,1,0,0,0,0,1]},t.scaling=function(t,n,e){return[t,0,0,0,0,n,0,0,0,0,e,0,0,0,0,1]},t.multiply=function(t,n){var e=n[0],o=n[1],r=n[2],i=n[3],s=n[4],c=n[5],a=n[6],u=n[7],p=n[8],f=n[9],l=n[10],h=n[11],y=n[12],g=n[13],d=n[14],v=n[15],_=t[0],m=t[1],w=t[2],b=t[3],x=t[4],O=t[5],C=t[6],E=t[7],A=t[8],S=t[9],T=t[10],j=t[11],P=t[12],R=t[13],I=t[14],L=t[15];return[e*_+o*x+r*A+i*P,e*m+o*O+r*S+i*R,e*w+o*C+r*T+i*I,e*b+o*E+r*j+i*L,s*_+c*x+a*A+u*P,s*m+c*O+a*S+u*R,s*w+c*C+a*T+u*I,s*b+c*E+a*j+u*L,p*_+f*x+l*A+h*P,p*m+f*O+l*S+h*R,p*w+f*C+l*T+h*I,p*b+f*E+l*j+h*L,y*_+g*x+d*A+v*P,y*m+g*O+d*S+v*R,y*w+g*C+d*T+v*I,y*b+g*E+d*j+v*L]},t.translate=function(n,e,o,r){return t.multiply(n,t.translation(e,o,r))},t.xRotate=function(n,e){return t.multiply(n,t.xRotation(e))},t.yRotate=function(n,e){return t.multiply(n,t.yRotation(e))},t.zRotate=function(n,e){return t.multiply(n,t.zRotation(e))},t.scale=function(n,e,o,r){return t.multiply(n,t.scaling(e,o,r))},t.projection=function(t,n,e){return[2/t,0,0,0,0,-2/n,0,0,0,0,2/e,0,-1,1,0,1]},t.orthographic=function(t,n,e,o,r,i){return[2/(n-t),0,0,0,0,2/(o-e),0,0,0,0,2/(r-i),0,(t+n)/(t-n),(e+o)/(e-o),(r+i)/(r-i),1]},t}();var rt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),it=function(){};const st=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.tilesets=[],n.context=null,n.shaderPath="/shaders",n._drawables=[],n._vertexShaders=[],n._fragmentShaders=[],n._testTranslationAmount=[0,0,0],n._testRotationAmount=[0,1,0],n._testScaleAmount=[1,1,0],n._testTranslateSpeed=100,n.angleInDegress=0,n.angleInRadians=0,n}return rt(n,t),n.prototype.init=function(){return t=this,n=void 0,o=function(){var t,n,e,o;return function(t,n){var e,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(t,s)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(r){switch(r.label){case 0:if(this.context=this.engineCanvas.getContext("webgl"),!this.context)throw"WebGL not supported.";return this.engineCanvas.width=window.innerWidth,this.engineCanvas.height=window.innerHeight,[4,fetch(this.shaderPath+"/vertex-shader.glsl")];case 1:return[4,r.sent().text()];case 2:return t=r.sent(),[4,fetch(this.shaderPath+"/fragment-shader.glsl")];case 3:return[4,r.sent().text()];case 4:return n=r.sent(),e=this._createShader(this.context.VERTEX_SHADER,t),o=this._createShader(this.context.FRAGMENT_SHADER,n),this._program=this._createProgram(e,o),this._positionAttributeLocation=this.context.getAttribLocation(this._program,"a_position"),this._colorAttributeLocation=this.context.getAttribLocation(this._program,"a_color"),this._colorBuffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,this._colorBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Uint8Array([255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.context.STATIC_DRAW),this._colorUniformLocation=this.context.getUniformLocation(this._program,"u_color"),this._resolutionUniformLocation=this.context.getUniformLocation(this._program,"u_resolution"),this._matrixUniformLocation=this.context.getUniformLocation(this._program,"u_matrix"),this._createDrawable([10,20,0,80,20,0,10,30,0,10,30,0,80,20,0,80,30,0]),[2]}}))},new((e=void 0)||(e=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function c(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}a((o=o.apply(t,n||[])).next())}));var t,n,e,o},n.prototype._createDrawable=function(t){var n=new it;n.positions=t,n.buffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,n.buffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array(n.positions),this.context.STATIC_DRAW),this._drawables.push(n)},n.prototype._convertAngleUnitCircleCoordinates=function(t){var n=t*Math.PI/180;return{sine:Math.sin(n),cosine:Math.cos(n)}},n.prototype.draw=function(){var t=this;console.log("[WEBGL]: Draw");var n=this._convertAngleUnitCircleCoordinates(this.angleInDegress);this._testRotationAmount[0]=n.sine,this._testRotationAmount[1]=n.cosine,this.context.viewport(0,0,this.engineCanvas.width,this.engineCanvas.height),this.context.clearColor(0,0,0,0),this.context.clear(this.context.COLOR_BUFFER_BIT),this.context.useProgram(this._program),this.context.uniform2f(this._resolutionUniformLocation,this.engineCanvas.width,this.engineCanvas.height),this._drawables.forEach((function(n){t.context.enableVertexAttribArray(t._positionAttributeLocation),t.context.bindBuffer(t.context.ARRAY_BUFFER,n.buffer);var e=t.context.FLOAT;t.context.vertexAttribPointer(t._positionAttributeLocation,3,e,!1,0,0),t.context.enableVertexAttribArray(t._colorAttributeLocation),t.context.bindBuffer(t.context.ARRAY_BUFFER,t._colorBuffer);var o=t.context.UNSIGNED_BYTE;t.context.vertexAttribPointer(t._colorAttributeLocation,3,o,!1,0,0),t.context.uniform4f(t._colorUniformLocation,1,1,1,1);var r=ot.projection(t.context.canvas.width,t.context.canvas.height,400);r=ot.translate(r,t._testTranslationAmount[0],t._testTranslationAmount[1],t._testTranslationAmount[2]),r=ot.xRotate(r,t.angleInDegress*Math.PI/180),r=ot.yRotate(r,t.angleInDegress*Math.PI/180),r=ot.zRotate(r,t.angleInDegress*Math.PI/180),r=ot.scale(r,t._testScaleAmount[0],t._testScaleAmount[1],t._testScaleAmount[2]),t.context.uniformMatrix4fv(t._matrixUniformLocation,!1,r);var i=t.context.TRIANGLES;t.context.drawArrays(i,0,6)}))},n.prototype._createShader=function(t,n){var e=this.context.createShader(t);if(this.context.shaderSource(e,n),this.context.compileShader(e),this.context.getShaderParameter(e,this.context.COMPILE_STATUS))return e;throw console.log(this.context.getShaderInfoLog(e)),this.context.deleteShader(e),"[SHADER ERROR]: Unable to load shader "+t},n.prototype._createProgram=function(t,n){var e=this.context.createProgram();if(this.context.attachShader(e,t),this.context.attachShader(e,n),this.context.linkProgram(e),this.context.getProgramParameter(e,this.context.LINK_STATUS))return e;throw console.log(this.context.getProgramInfoLog(e)),this.context.deleteProgram(e),"[SHADER ERROR]: Unable to link shaders to program"},n}(et),ct=function(t,n){this.x=t,this.y=n};var at=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const ut=function(t){function n(n,e){var o=t.call(this,n,e)||this;return o.tilesets=[],o.mainCamera=new A,o}return at(n,t),n.prototype.init=function(){var t=this;this.engineCanvas=document.querySelector("#engine-canvas"),this.context=this.engineCanvas.getContext("2d"),this.engineCanvas.addEventListener("mousedown",(function(n){return t.onCanvasMouseDown(n)})),this.engineCanvas.addEventListener("mouseup",(function(n){return t.onCanvasMouseUp(n)})),this.engineCanvas.addEventListener("mousemove",(function(n){return t.onCanvasMouseMove(n)})),this.mainCamera.viewport=new T(0,0,this.getCanvasWidth(),this.getCanvasHeight()),this.mainCamera.max=new ct(this.scene.columns*this.scene.tileSize-this.mainCamera.viewport.width,this.scene.rows*this.scene.tileSize-this.mainCamera.viewport.height)},n.prototype.draw=function(){this.clearCanvas(),this.render(),this.resizeCanvas()},n.prototype.render=function(){var t=this;this.scene.layers.forEach((function(n,e){if(n.enabled){var o=s.get(_.name);o.entities.forEach((function(n){var e=o.getInstance(n),r=n.getComponent(p),i=n.getComponent(C);i&&t.applyMaterial(i),t.context.drawImage(t.tilesets[e.tilesetIndex].image,e.column*t.scene.tileSize,e.row*t.scene.tileSize,t.scene.tileSize,t.scene.tileSize,r.transform.x-0,r.transform.y-0,t.scene.tileSize,t.scene.tileSize)}))}}))},n.prototype.applyMaterial=function(t){this.context.fillStyle=t.fillStyle,this.context.globalAlpha=t.alpha},n.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.getCanvasWidth(),this.getCanvasHeight())},n.prototype.resizeCanvas=function(){this.getCanvasWidth()===window.innerWidth&&this.getCanvasHeight()===window.innerHeight||(this.setCanvasWidth(window.innerWidth),this.setCanvasHeight(window.innerHeight))},n.prototype.getCanvasHeight=function(){return this.engineCanvas.height},n.prototype.getCanvasWidth=function(){return this.engineCanvas.width},n.prototype.setCanvasHeight=function(t){this.engineCanvas.height=t},n.prototype.setCanvasWidth=function(t){this.engineCanvas.width=t},n.prototype.onCanvasMouseDown=function(t){console.log("mousedown")},n.prototype.onCanvasMouseUp=function(t){console.log("mouseup")},n.prototype.onCanvasMouseMove=function(t){console.log("mousemove")},n}(et);var pt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ft=function(t){function n(){return t.call(this)||this}return pt(n,t),n.prototype.onStart=function(){},n}(function(){function n(){j.register(new y),j.register(new $),s.register(w,K),s.register(p,q),s.register(d,W),s.register(C,Q),s.register(_,k),s.register(i,z),s.register(x,D),s.register(a,nt)}return n.prototype.init=function(t){return n=this,e=void 0,r=function(){var n,e,o,r,i=this;return function(t,n){var e,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(t,s)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(s){switch(s.label){case 0:return t||(t="canvas"),n="manifest.json",(e=new URLSearchParams(location.search)).has("baseUrl")&&(R.baseUrl=decodeURIComponent(e.get("baseUrl")),n=R.baseUrl+"/"+n),[4,fetch(n).catch(this.handleLoadError)];case 1:return[4,s.sent().json()];case 2:return o=s.sent(),[4,N.load(o.scenes[0])];case 3:return r=s.sent(),this.renderer="webgl"===t?new st(r.scene,r.tilesets):new ut(r.scene,r.tilesets),this.renderer.init(),this.onStart(),window.requestAnimationFrame((function(t){return i.mainLoop(t)})),[2]}}))},new((o=void 0)||(o=Promise))((function(t,i){function s(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(n){var e;n.done?t(n.value):(e=n.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,c)}a((r=r.apply(n,e||[])).next())}));var n,e,o,r},n.prototype.handleLoadError=function(t){return console.warn(t),new Response(JSON.stringify({code:500,message:t.error}))},n.prototype.mainLoop=function(n){var e=this;t.calculateDeltaTime(n),j.systems.forEach((function(t){t.update()})),this.renderer.draw(),window.requestAnimationFrame((function(t){return e.mainLoop(t)}))},n}());document.addEventListener("DOMContentLoaded",(function(t){(new ft).init("canvas")}))})();