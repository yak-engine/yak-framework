!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("yak-engine",[],e):"object"==typeof exports?exports["yak-engine"]=e():t["yak-engine"]=e()}(window,function(){return n=[function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TransformComponent=e.TilemapComponent=e.TagComponent=e.SpriteRendererComponent=e.ScriptComponent=e.MaterialComponent=e.ImageComponent=e.ColliderComponent=e.CameraComponent=void 0;const i=n(1);e.CameraComponent=class{constructor(t){this.camera=t}};e.ColliderComponent=class{constructor(t,e){this.transform=t,this.isTrigger=e,this._points=new Array,this._points.push(new i.Point(t.x,t.y)),this._points.push(new i.Point(t.x+t.width,t.y)),this._points.push(new i.Point(t.x,t.y+t.height)),this._points.push(new i.Point(t.x+t.width,t.y+t.height))}};e.ImageComponent=class{};e.MaterialComponent=class{constructor(){this.alpha=1}};e.ScriptComponent=class{constructor(t){this.scritableEntity=t}};e.SpriteRendererComponent=class{};e.TagComponent=class{constructor(t){this.name=t}};e.TilemapComponent=class{constructor(){this.layer=0,this.tilesetIndex=0,this.tiles=[]}};e.TransformComponent=class{constructor(t){this.transform=t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0;e.Point=class{constructor(t,e){this.x=t,this.y=e}}},function(h,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManagerFactory=void 0;const n=e(0),i=e(0),s=e(0),o=e(0),r=e(0),a=e(0),u=e(0),d=e(0),p=e(0),c=e(13);class l{constructor(){}static bootstrap(){l.register(n.TagComponent.name,new c.ComponentManager),l.register(i.TransformComponent.name,new c.ComponentManager),l.register(a.CameraComponent.name,new c.ComponentManager),l.register(o.MaterialComponent.name,new c.ComponentManager),l.register(s.SpriteRendererComponent.name,new c.ComponentManager),l.register(r.ColliderComponent.name,new c.ComponentManager),l.register(u.ImageComponent.name,new c.ComponentManager),l.register(d.ScriptComponent.name,new c.ComponentManager),l.register(p.TilemapComponent.name,new c.ComponentManager)}static register(t,e){l.managers.has(t)||l.managers.set(t,e)}static get(t){if(console.log(t),l.managers.has(t))return l.managers.get(t);throw"Manager has not been registered: "+t}static log(){l.managers.forEach(t=>console.log(t))}}(t.ManagerFactory=l).managers=new Map},function(t,e,n){"use strict";var i,s;Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=e.LogThreshold=void 0,(s=i=e.LogThreshold||(e.LogThreshold={}))[s.NONE=0]="NONE",s[s.DATA=1]="DATA",s[s.DEBUG=2]="DEBUG",s[s.INFO=3]="INFO",s[s.ERROR=4]="ERROR",s[s.CRITICAL=5]="CRITICAL";class o{static debug(t){this.thresholds.includes(i.DEBUG)&&console.log("[YAK DEBUG]: "+t)}static info(t,e){this.thresholds.includes(i.INFO)&&console.info(`%c [YAK INFO - ${e}]: `+t,"background: #222; color: #bada55")}static error(t){this.thresholds.includes(i.ERROR)&&console.error("[YAK ERROR]: "+t)}static critical(t){this.thresholds.includes(i.CRITICAL)&&console.error("[YAK CRITICAL]: "+t)}static data(t,e){this.thresholds.includes(i.DATA)&&console.log("%c [YAK DATA]: "+t,"background: #222; color: #bada55",e)}}(e.Logger=o).thresholds=[i.DATA,i.DEBUG,i.INFO,i.ERROR,i.CRITICAL]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transform=void 0;e.Transform=class i{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}getScreenX(t){return this.x-t.viewport.x}clampX(t,e){return this.x<t?(this.x=t,!0):this.x>e&&(this.x=e,!0)}clampY(t,e){return this.y<=t?(this.y=t,!0):this.y>=e&&(this.y=e,!0)}offsetX(){return this.x+this.width}offsetY(){return this.y+this.height}lerp(t,e,n){return t+(e-t)*(n=1<(n=n<0?0:n)?1:n)}static get empty(){return new i(0,0,0,0)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Time=void 0;class i{static calculateDeltaTime(t){if(!i.lastTimestamp)return i.lastTimestamp=t,void(i.fps=0);i.deltaTime=(t-i.lastTimestamp)/1e3,i.lastTimestamp=t,i.fps=1/i.deltaTime}}(e.Time=i).lastTimestamp=performance.now()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;e.Camera=class{constructor(){this.orthographicSize=5}isClampedX(){return this.viewport.x>=this.max.x/2||0===this.viewport.x}isClampedY(){return this.viewport.y>=this.max.y/2||0===this.viewport.y}update(){}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;const i=n(2);e.Entity=class{constructor(){this.id="",this.enabled=!0}addComponent(t){let e=i.ManagerFactory.get(t.constructor.name);e.addComponentInstance(this,t)}getComponent(t){t=i.ManagerFactory.get(t.name);return t.instances[t.map[this.id]]}getScriptInstances(){return[]}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Configuration=void 0;class i{}(e.Configuration=i).engineConfig=null,i.gridSquareSize=32,i.canvasFill="#181818",i.selectionTransformFill="rgba(252,248,227, 0.7)"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;e.System=class{}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseRenderer=void 0;e.BaseRenderer=class{}},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,r,a,c){return new(a=a||Promise)(function(n,e){function i(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}o((c=c.apply(t,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.SceneManager=void 0;const c=n(12),l=n(14),h=n(15),u=n(3);e.SceneManager=class d{static load(r,a=""){return i(this,void 0,void 0,function*(){u.Logger.info("Started loading scene.",d.name);let t=r+".json",e=(a&&(t=a+"\\"+t),yield fetch(t));var n,i=yield e.json();u.Logger.info("Scene loaded and parsed successfully",d.name),c.EntityManager.getInstance().unpackEntityManifests(i);let s=new Array;for(n of i.tilesets){let t=new Image;var o=a+"/tilesets/"+n;t.src=o,yield t.decode(),s.push(new l.Tileset(t)),u.Logger.info(`Scene tileset ${n} loaded`,d.name)}return u.Logger.info("Finished loading scene",d.name),new h.LoadSceneReturn(i,s)})}}},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityManager=void 0;const i=e(2),o=e(6),r=e(7),d=e(1),a=e(4),c=e(3),l=e(0),h=e(0),p=e(0),m=e(0);class u{constructor(){this.entities=[]}static getInstance(){return u.instance||(u.instance=new u),u.instance}create(){let t=new r.Entity;this.entities.push(t);for(var e="",n=0;n<8;n++){var i=Math.floor(Math.random()*u.characters.length);e+=u.characters.substring(i,i+1)}return t.id=e,t.addComponent(new l.TagComponent("entity"+t.id)),t.addComponent(new h.TransformComponent(a.Transform.empty)),t}dispose(e){var t=this.entities.findIndex(t=>t.id===e.id);-1!==t&&this.entities.splice(t,1)}unpackEntityManifests(t){let s=[];t.entityManifests.forEach(t=>{let e=new r.Entity;for(var n in e.id=t.id,e.enabled=t.enabled,t){var i=t[n];if(i)if("spriteRendererComponent"===n)e.addComponent({layer:i.layer,tileset:i.tileset,row:i.row,column:i.column});else if("transformComponent"===n)e.addComponent(new h.TransformComponent(new a.Transform(i.x,i.y,i.width,i.height)));else if("cameraComponent"===n){let t=new o.Camera;t.viewport=new a.Transform(i.camera.viewport.x,i.camera.viewport.y,i.camera.viewport.width,i.camera.viewport.height),t.max=new d.Point(i.camera.max.x,i.camera.max.y),e.addComponent(new m.CameraComponent(t))}else"tagComponent"===n?e.addComponent(new l.TagComponent(i.name)):"colliderComponent"===n&&e.addComponent(new p.ColliderComponent(i.transform,i.isTrigger))}c.Logger.info(`Scene entity ${t.id} parsed`,u.name),s.push(e)}),u.getInstance().entities=s,c.Logger.info(`Finished parsing ${s.length} entities`,u.name)}packEntities(){return[]}getComponents(e){let n=[];return i.ManagerFactory.managers.forEach(t=>{t.map[e.id]&&n.push(t.instances[t.map[e.id]])}),n}}(t.EntityManager=u).characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentManager=void 0;const i=n(0);e.ComponentManager=class{constructor(){this.instances=[],this.entities=[],this.map={}}addComponentInstance(t,e){if(this.map[t.id]){if(typeof e!=typeof i.ScriptComponent)throw console.error(e),`[${e.constructor.name}]: You can't not have multiple component of the same type on entity unless that component is a script.`}else this.entities.push(t);this.instances.push(e),this.map[t.id]=this.instances.length-1}getInstance(t){t=this.map[t.id];return t||0===t?this.instances[t]:null}dispose(e){var t;"ScriptComponentManager"===this.constructor.name&&console.log(this),this.map[e.id]&&(this.instances.splice(this.map[e.id]),delete this.map[e.id],-1!==(t=this.entities.findIndex(t=>t.id===e.id))&&this.entities.splice(t,1),console.log(this))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tileset=void 0;e.Tileset=class{constructor(t){this.image=t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadSceneReturn=void 0;e.LoadSceneReturn=class{constructor(t,e){this.tilesets=new Array,this.scene=t,this.tilesets=e}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SystemManager=void 0;class i{static register(e){-1===i.systems.findIndex(t=>t.name===e.name)&&i.systems.push(e)}static get(e){return i.systems.find(t=>t.name===e)}}(e.SystemManager=i).systems=[]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollisionSystem=void 0;const h=n(0),u=n(0),d=n(0),p=n(2),m=n(18);class i extends n(9).System{constructor(){super(...arguments),this.name="collision",this.currentEntityCollisions=new Map}dispose(i){this.currentEntityCollisions.has(i.id)&&this.currentEntityCollisions.delete(i.id),this.currentEntityCollisions.forEach((t,e)=>{var n=t.indexOf(i.id);-1!==n&&t.splice(n,1)})}update(){var n=p.ManagerFactory.get(h.ColliderComponent.name);for(let e=0;e<n.entities.length;e++)for(let t=e+1;t<n.entities.length;t++)this.resolveCollision(n.entities[e],n.entities[t])}resolveCollision(n,i){if(n&&i){var s=n.getComponent(h.ColliderComponent),o=i.getComponent(h.ColliderComponent),r=n.getComponent(d.TransformComponent),a=i.getComponent(d.TransformComponent);if(r&&a){let t=r.transform;var r=a.transform,a=t.x+t.width/2-(r.x+r.width/2),c=t.y+t.height/2-(r.y+r.height/2),l=t.width/2+r.width/2,r=t.height/2+r.height/2;let e=m.CollisionDirection.NONE;return Math.abs(a)<l&&Math.abs(c)<r?this.currentEntityCollisions.has(n.id)&&-1!==this.currentEntityCollisions.get(n.id).indexOf(i.id)?(console.log("TRIGGER STAY"),n.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerStay(i)}),i.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerStay(n)})):(this.currentEntityCollisions.has(n.id)?this.currentEntityCollisions.get(n.id).push(i.id):this.currentEntityCollisions.set(n.id,[i.id]),s.isTrigger||o.isTrigger?(console.log("TRIGGER ENTER"),console.log(n),console.log(i),n.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerEnter(i)}),i.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerEnter(n)})):(s=l-Math.abs(a),(o=r-Math.abs(c))<=s?0<c?(e=m.CollisionDirection.TOP,t.y+=o):(e=m.CollisionDirection.BOTTOM,t.y-=o):0<a?(e=m.CollisionDirection.LEFT,t.x+=s):(e=m.CollisionDirection.RIGHT,t.x-=s))):this.currentEntityCollisions.has(n.id)&&-1!==this.currentEntityCollisions.get(n.id).indexOf(i.id)&&(this.currentEntityCollisions.delete(n.id),p.ManagerFactory.get(u.ScriptComponent.name).instances,n.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerLeave(i)}),i.getScriptInstances().forEach(t=>{t.instance&&t.instance.onTriggerEnter&&t.instance.onTriggerLeave(n)})),e}console.log("[ENTITY NO LONGER EXISTS ABORTING COLLISION CHECK]")}}}e.CollisionSystem=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollisionDirection=void 0,(e=e.CollisionDirection||(e.CollisionDirection={}))[e.NONE=0]="NONE",e[e.TOP=1]="TOP",e[e.RIGHT=2]="RIGHT",e[e.BOTTOM=3]="BOTTOM",e[e.LEFT=4]="LEFT"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScriptSystem=void 0;class i extends n(9).System{constructor(){super(...arguments),this.name="script"}update(){}dispose(t){}}e.ScriptSystem=i},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,r,a,c){return new(a=a||Promise)(function(n,e){function i(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}o((c=c.apply(t,r||[])).next())})},s=(Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLRenderer=void 0,n(10));const o=n(21);class r{}class a extends s.BaseRenderer{constructor(t,e){super(),this.tilesets=[],this.shaderPath="/shaders",this._drawables=[],this._vertexShaders=[],this._fragmentShaders=[],this._testTranslationAmount=[0,0,0],this._testRotationAmount=[0,1,0],this._testScaleAmount=[1,1,0],this._testTranslateSpeed=100,this.angleInDegress=0,this.angleInRadians=0,this.scene=t,this.tilesets=e}init(){return i(this,void 0,void 0,function*(){if(this.context=this.engineCanvas.getContext("webgl"),!this.context)throw"WebGL not supported.";this.engineCanvas.width=window.innerWidth,this.engineCanvas.height=window.innerHeight;var t=yield(yield fetch(this.shaderPath+"/vertex-shader.glsl")).text(),e=yield(yield fetch(this.shaderPath+"/fragment-shader.glsl")).text(),t=this._createShader(this.context.VERTEX_SHADER,t),e=this._createShader(this.context.FRAGMENT_SHADER,e);this._program=this._createProgram(t,e),this._positionAttributeLocation=this.context.getAttribLocation(this._program,"a_position"),this._colorAttributeLocation=this.context.getAttribLocation(this._program,"a_color"),this._colorBuffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,this._colorBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Uint8Array([255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.context.STATIC_DRAW),this._colorUniformLocation=this.context.getUniformLocation(this._program,"u_color"),this._resolutionUniformLocation=this.context.getUniformLocation(this._program,"u_resolution"),this._matrixUniformLocation=this.context.getUniformLocation(this._program,"u_matrix"),this._createDrawable([10,20,0,80,20,0,10,30,0,10,30,0,80,20,0,80,30,0])})}_createDrawable(t){let e=new r;e.positions=t,e.buffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,e.buffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array(e.positions),this.context.STATIC_DRAW),this._drawables.push(e)}_convertAngleUnitCircleCoordinates(t){t=t*Math.PI/180;return{sine:Math.sin(t),cosine:Math.cos(t)}}draw(){console.log("[WEBGL]: Draw");var t=this._convertAngleUnitCircleCoordinates(this.angleInDegress);this._testRotationAmount[0]=t.sine,this._testRotationAmount[1]=t.cosine,this.context.viewport(0,0,this.engineCanvas.width,this.engineCanvas.height),this.context.clearColor(0,0,0,0),this.context.clear(this.context.COLOR_BUFFER_BIT),this.context.useProgram(this._program),this.context.uniform2f(this._resolutionUniformLocation,this.engineCanvas.width,this.engineCanvas.height),this._drawables.forEach(t=>{this.context.enableVertexAttribArray(this._positionAttributeLocation),this.context.bindBuffer(this.context.ARRAY_BUFFER,t.buffer);t=this.context.FLOAT,this.context.vertexAttribPointer(this._positionAttributeLocation,3,t,!1,0,0),this.context.enableVertexAttribArray(this._colorAttributeLocation),this.context.bindBuffer(this.context.ARRAY_BUFFER,this._colorBuffer),t=this.context.UNSIGNED_BYTE,this.context.vertexAttribPointer(this._colorAttributeLocation,3,t,!1,0,0),this.context.uniform4f(this._colorUniformLocation,1,1,1,1),t=o.default.projection(this.context.canvas.width,this.context.canvas.height,400),this.context.uniformMatrix4fv(this._matrixUniformLocation,!1,t),t=this.context.TRIANGLES;this.context.drawArrays(t,0,6)})}_createShader(t,e){var n=this.context.createShader(t),e=(this.context.shaderSource(n,e),this.context.compileShader(n),this.context.getShaderParameter(n,this.context.COMPILE_STATUS));if(e)return n;throw console.log(this.context.getShaderInfoLog(n)),this.context.deleteShader(n),"[SHADER ERROR]: Unable to load shader "+t}_createProgram(t,e){var n=this.context.createProgram(),t=(this.context.attachShader(n,t),this.context.attachShader(n,e),this.context.linkProgram(n),this.context.getProgramParameter(n,this.context.LINK_STATUS));if(t)return n;throw console.log(this.context.getProgramInfoLog(n)),this.context.deleteProgram(n),"[SHADER ERROR]: Unable to link shaders to program"}}e.WebGLRenderer=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}static identity(){return[1,0,0,0,1,0,0,0,1]}static translation(t,e,n){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1]}static xRotation(t){var e=Math.cos(t),t=Math.sin(t);return[1,0,0,0,0,e,t,0,0,-t,e,0,0,0,0,1]}static yRotation(t){var e=Math.cos(t),t=Math.sin(t);return[e,0,-t,0,0,1,0,0,t,0,e,0,0,0,0,1]}static zRotation(t){var e=Math.cos(t),t=Math.sin(t);return[e,t,0,0,-t,e,0,0,0,0,1,0,0,0,0,1]}static scaling(t,e,n){return[t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1]}static multiply(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=e[9],d=e[10],p=e[11],m=e[12],g=e[13],f=e[14],e=e[15],y=t[0],v=t[1],C=t[2],w=t[3],_=t[4],x=t[5],M=t[6],b=t[7],T=t[8],S=t[9],P=t[10],E=t[11],R=t[12],O=t[13],A=t[14],t=t[15];return[n*y+i*_+s*T+o*R,n*v+i*x+s*S+o*O,n*C+i*M+s*P+o*A,n*w+i*b+s*E+o*t,r*y+a*_+c*T+l*R,r*v+a*x+c*S+l*O,r*C+a*M+c*P+l*A,r*w+a*b+c*E+l*t,h*y+u*_+d*T+p*R,h*v+u*x+d*S+p*O,h*C+u*M+d*P+p*A,h*w+u*b+d*E+p*t,m*y+g*_+f*T+e*R,m*v+g*x+f*S+e*O,m*C+g*M+f*P+e*A,m*w+g*b+f*E+e*t]}static translate(t,e,n,i){return s.multiply(t,s.translation(e,n,i))}static xRotate(t,e){return s.multiply(t,s.xRotation(e))}static yRotate(t,e){return s.multiply(t,s.yRotation(e))}static zRotate(t,e){return s.multiply(t,s.zRotation(e))}static scale(t,e,n,i){return s.multiply(t,s.scaling(e,n,i))}static projection(t,e,n){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/n,0,-1,1,0,1]}static orthographic(t,e,n,i,s,o){return[2/(e-t),0,0,0,0,2/(i-n),0,0,0,0,2/(s-o),0,(t+e)/(t-e),(n+i)/(n-i),(s+o)/(s-o),1]}}e.default=s},function(h,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;const n=e(1),i=e(4);var s=e(10);const o=e(2),r=e(0),a=e(0),u=e(0),d=e(0),c=e(3),p=e(6);class l extends s.BaseRenderer{constructor(t,e){if(super(),this.tilesets=[],this.mainCamera=new p.Camera,this.scene=t,this.tilesets=e,!this.scene)throw"You cannot initialize the renderer without a scene.";if(!this.tilesets||0===this.tilesets.length)throw"You cannot initialize the renderer without any tilesets.";this.engineCanvas=document.querySelector("#engine-canvas"),this.context=this.engineCanvas.getContext("2d")}init(){c.Logger.info("Started initializing canvas renderer",l.name),this.engineCanvas.addEventListener("mousedown",t=>this.onCanvasMouseDown(t)),this.engineCanvas.addEventListener("mouseup",t=>this.onCanvasMouseUp(t)),this.engineCanvas.addEventListener("mousemove",t=>this.onCanvasMouseMove(t)),this.mainCamera.viewport=new i.Transform(0,0,this.getCanvasWidth(),this.getCanvasHeight()),this.mainCamera.max=new n.Point(this.scene.columns*this.scene.tileSize-this.mainCamera.viewport.width,this.scene.rows*this.scene.tileSize-this.mainCamera.viewport.height),c.Logger.info("Finished initializing canvas renderer",l.name)}draw(){this.clearCanvas(),this.render(),this.resizeCanvas()}render(){this.scene.layers.forEach((t,e)=>{if(t.enabled){let t=o.ManagerFactory.get(d.TilemapComponent.name),i=(t.instances.forEach(n=>{for(let e=0;e<=64;e++)for(let t=0;t<=64;t++){var i=n.tiles[64*t+e],s=32*+e+0,o=32*+t+0;this.context.drawImage(this.tilesets[n.tilesetIndex].image,32*i,0,32,32,Math.round(s),Math.round(o),32,32)}}),o.ManagerFactory.get(r.SpriteRendererComponent.name));i.entities.forEach(t=>{var e=i.getInstance(t),n=t.getComponent(u.TransformComponent),t=t.getComponent(a.MaterialComponent);t&&this.applyMaterial(t),this.context.drawImage(this.tilesets[0].image,e.column*this.scene.tileSize,e.row*this.scene.tileSize,this.scene.tileSize,this.scene.tileSize,+n.transform.x,+n.transform.y,this.scene.tileSize,this.scene.tileSize)})}})}applyMaterial(t){this.context.fillStyle=t.fillStyle,this.context.globalAlpha=t.alpha}clearCanvas(){this.context.clearRect(0,0,this.getCanvasWidth(),this.getCanvasHeight())}resizeCanvas(){this.getCanvasWidth()===window.innerWidth&&this.getCanvasHeight()===window.innerHeight||(this.setCanvasWidth(window.innerWidth),this.setCanvasHeight(window.innerHeight))}getCanvasHeight(){return this.engineCanvas.height}getCanvasWidth(){return this.engineCanvas.width}setCanvasHeight(t){this.engineCanvas.height=t}setCanvasWidth(t){this.engineCanvas.width=t}onCanvasMouseDown(t){console.log("mousedown")}onCanvasMouseUp(t){console.log("mouseup")}onCanvasMouseMove(t){console.log("mousemove")}}t.CanvasRenderer=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isCoordinateContained=void 0,e.isCoordinateContained=function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7);const s=n(1);class o extends i.Entity{constructor(t){super(),this.isTrigger=!1,this.isTriggered=!1,this.points=new Array,this.points.push(new s.Point(t.x,t.y)),this.points.push(new s.Point(t.x+t.width,t.y)),this.points.push(new s.Point(t.x,t.y+t.height)),this.points.push(new s.Point(t.x+t.width,t.y+t.height))}}e.default=o},function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){t[i=void 0===i?n:i]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||i(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),s(n(26),e),s(n(13),e),s(n(8),e),s(n(27),e),s(n(12),e),s(n(2),e),s(n(11),e),s(n(16),e),s(n(5),e),s(n(10),e),s(n(22),e),s(n(20),e),s(n(6),e),s(n(28),e),s(n(29),e),s(n(30),e),s(n(21),e),s(n(31),e),s(n(32),e),s(n(14),e),s(n(33),e),s(n(34),e),s(n(35),e),s(n(36),e),s(n(23),e),s(n(37),e),s(n(38),e),s(n(39),e),s(n(3),e),s(n(15),e),s(n(24),e),s(n(40),e),s(n(41),e),s(n(1),e),s(n(4),e),s(n(0),e),s(n(7),e),s(n(42),e),s(n(43),e),s(n(44),e),s(n(18),e),s(n(17),e),s(n(19),e),s(n(45),e),s(n(9),e)},function(h,t,e){"use strict";var n=this&&this.__awaiter||function(t,r,a,c){return new(a=a||Promise)(function(n,e){function i(t){try{o(c.next(t))}catch(t){e(t)}}function s(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}o((c=c.apply(t,r||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Application=void 0;const i=e(5),s=e(11),o=e(8),r=e(16),a=e(2),u=e(17),d=e(19),p=e(20),m=e(22),c=e(3);t.Application=class l{constructor(){this.type="canvas",r.SystemManager.register(new u.CollisionSystem),r.SystemManager.register(new d.ScriptSystem),a.ManagerFactory.bootstrap(),c.Logger.info(`Registered ${a.ManagerFactory.managers.size} manager(s)`,l.name),c.Logger.data("Registered manager(s)",a.ManagerFactory.managers)}init(){return n(this,void 0,void 0,function*(){c.Logger.info("[Started initializing application]",l.name);let t="manifest.json";const e=new URLSearchParams(location.search);e.has("baseUrl")&&(o.Configuration.baseUrl=decodeURIComponent(e.get("baseUrl")),t=o.Configuration.baseUrl+"/"+t);var n=yield(yield fetch(t).catch(this.handleLoadError)).json();s.SceneManager.load(n.scenes[0]).then(t=>{"webgl"===this.type?this.renderer=new p.WebGLRenderer(t.scene,t.tilesets):this.renderer=new m.CanvasRenderer(t.scene,t.tilesets),this.renderer.init(),this.onStart(),window.requestAnimationFrame(t=>this.mainLoop(t))})})}handleLoadError(t){return console.warn(t),new Response(JSON.stringify({code:500,message:t.error}))}mainLoop(t){i.Time.calculateDeltaTime(t),this.renderer.draw(),window.requestAnimationFrame(t=>this.mainLoop(t))}}},function(h,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YakConstants=void 0;var n=e(0),i=e(0),s=e(0),o=e(0),r=e(0),a=e(0),c=e(0),e=e(0);class l{}(t.YakConstants=l).componentTypes=[n.TagComponent,i.TransformComponent,s.SpriteRendererComponent,o.MaterialComponent,r.ColliderComponent,a.CameraComponent,c.ImageComponent,e.ScriptComponent]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;const i=n(5);class s{constructor(){window.addEventListener("keydown",t=>this._onKeyDown(t)),window.addEventListener("keyup",t=>this._onKeyUp(t))}_onKeyDown(t){s.codes.set(t.code.toLowerCase(),!0)}_onKeyUp(t){s.codes.has(t.code.toLowerCase())&&s.codes.set(t.code.toLowerCase(),!1)}static isPressed(t){return s.codes.has(t.toLowerCase())}static horizontal(){let t;return t=s.isPressed("keya")?-1:s.isPressed("keyd")?1:0}static vertical(){let t;return(t=s.isPressed("keyw")?-1:s.isPressed("keys")?1:0)*i.Time.deltaTime}}(e.Input=s).codes=new Map},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Layer=void 0;e.Layer=class{constructor(t,e,n,i){this.name=t,this.enabled=e,this.locked=n,this.order=i}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static identity(){return[1,0,0,0,1,0,0,0,1]}static projection(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]}static translation(t,e){return[1,0,0,0,1,0,t,e,1]}static rotation(t){var e=Math.cos(t),t=Math.sin(t);return[e,-t,0,t,e,0,0,0,1]}static scaling(t,e){return[t,0,0,0,e,0,0,0,1]}static multiply(t,e){var n=t[0],i=t[1],s=t[2],o=t[3],r=t[4],a=t[5],c=t[6],l=t[7],t=t[8],h=e[0],u=e[1],d=e[2],p=e[3],m=e[4],g=e[5],f=e[6],y=e[7],e=e[8];return[h*n+u*o+d*c,h*i+u*r+d*l,h*s+u*a+d*t,p*n+m*o+g*c,p*i+m*r+g*l,p*s+m*a+g*t,f*n+y*o+e*c,f*i+y*r+e*l,f*s+y*a+e*t]}static translate(t,e,n){return i.multiply(t,i.translation(e,n))}static rotate(t,e){return i.multiply(t,i.rotation(e))}static scale(t,e,n){return i.multiply(t,i.scaling(e,n))}}e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0;class i{constructor(){window.addEventListener("mousedown",t=>this.onMouseDown(t)),window.addEventListener("mouseup",t=>this.onMouseUp(t))}onMouseDown(t){i.buttons.set(t.button,!0)}onMouseUp(t){i.buttons.has(t.button)&&i.buttons.set(t.button,!1)}static isPressed(t){return i.buttons.has(t)}static update(t){this.lastMousePosition&&(this.xDiff=t.x-this.lastMousePosition.x,this.yDiff=t.y-this.lastMousePosition.y),this.lastMousePosition=t}}(e.Mouse=i).buttons=new Map,i.xDiff=0,i.yDiff=0,i.lastMousePosition=null},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;const s=n(4);e.Sprite=class{constructor(t,e,n,i=s.Transform.empty){this.transform=t,this.enabled=e,this.tileset=n,this.tilesetTransform=i}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.areTransformsEqual=void 0,e.areTransformsEqual=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.areTransformsOverlapping=void 0;const i=n(1),s=n(23);e.areTransformsOverlapping=function(t,e){return!!s.isCoordinateContained(new i.Point(t.x,t.y),e)||(!!s.isCoordinateContained(new i.Point(t.x+t.width,t.y),e)||(!!s.isCoordinateContained(new i.Point(t.x,t.y+t.height),e)||!!s.isCoordinateContained(new i.Point(t.x+t.width,t.y+t.height),e)))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pointWorldPosition=void 0;const i=n(8),s=n(1);e.pointWorldPosition=function(t){let e=new s.Point(0,0);return e.x=Math.floor(t.x/i.Configuration.gridSquareSize),e.y=Math.floor(t.y/i.Configuration.gridSquareSize),e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isCanvasBlank=void 0,e.isCanvasBlank=function(t){const e=t.getContext("2d"),n=new Uint32Array(e.getImageData(0,0,t.width,t.height).data.buffer);return!n.some(t=>0!==t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isTransformEmpty=void 0,e.isTransformEmpty=function(t){return 0===t.x&&0===t.y&&0===t.width&&0===t.height}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.screenToWorld=void 0,e.screenToWorld=function(t,e,n){return{x:e+t.viewport.x,y:n+t.viewport.y}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.worldToScreen=void 0;const i=n(1);e.worldToScreen=function(t,e,n){return new i.Point(e-t.viewport.x,n-t.viewport.y)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(3),s=n(1);class o extends n(24).default{constructor(t){super(t),this.points=new Array,this.points.push(new s.Point(t.x,t.y)),this.points.push(new s.Point(t.x+t.width,t.y)),this.points.push(new s.Point(t.x,t.y+t.height)),this.points.push(new s.Point(t.x+t.width,t.y+t.height))}onCollisionEnter(){i.Logger.info("Square collider trigger enter",this.toString())}onCollisionLeave(){i.Logger.info("Square collider trigger leave",this.toString())}}e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}(e.default=i).GRAVITATIONAL_CONSTANT=9.8,i.colliders=new Array},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Manifest=void 0;e.Manifest=class{constructor(t,e){this.name=t,this.scenes=e}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;e.Scene=class{constructor(t,e,n,i,s=[],o={},r=[],a=[],c=[]){this.name=t,this.rows=e,this.columns=n,this.tileSize=i,this.tilesets=s,this.tilemap=o,this.entities=r,this.layers=a,this.entityManifests=c}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static commit(t,e){i.data.set(t,e)}static get(t){return i.data.has(t)?i.data.get(t):null}static exists(t){return i.data.has(t)}static delete(t){i.data.has(t)&&i.data.delete(t)}}(e.default=i).data=new Map},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScriptableEntity=void 0;e.ScriptableEntity=class{onCreate(){}update(){}onTriggerEnter(t){}onTriggerLeave(t){}onTriggerStay(t){}addComponent(t){this.entity.addComponent(t)}getComponent(t){return this.entity.getComponent(t)}}}],i={},s.m=n,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=25);function s(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}var n,i});